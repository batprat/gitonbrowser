<div class="repo-detail">
    <div class="working-directory-details-container">
        <button class="btn btn-info" id="btn-refresh-local-changes" ng-click="vm.refreshLocalChanges()">Refresh local changes</button>
        <button class="btn btn-primary" ng-class="{'has-unstaged-files btn-danger': vm.unstagedFiles.length && !vm.stagedFiles.length, 'has-staged-and-unstaged-files btn-warning': vm.stagedFiles.length && vm.unstagedFiles.length, 'has-staged-files btn-success': vm.stagedFiles.length && !vm.unstagedFiles.length}" id="btn-commit" ng-click="vm.showCommitDialog()">Commit {{ vm.localStatus && vm.localStatus.length ? '(' + vm.localStatus.length + ')' : '' }}</button>
        <button class="btn btn-secondary" title="Open Pull Dialog" ng-click="vm.showPullDialog()"><i class="fa fa-arrow-down" aria-hidden="true"></i> Pull...</button>
        <button class="btn btn-secondary" title="Open Push Dialog" ng-click="vm.showPushDialog()"><i class="fa fa-arrow-up" aria-hidden="true"></i> Push...</button>
        <button class="btn btn-secondary" title="Open Stash Dialog" ng-click="vm.showStashDialog()"><i class="fa fa-database"></i> Stash...</button>
        <check-settings show-on-error-only="true"></check-settings>
        <div id="log-search-container" class="pull-right">
            <div class="input-group">
                <div class="input-group-prepend">
                    <div class="input-group-text"><i class="fa fa-search" aria-hidden="true"></i></div>
                </div>
                <input type="text" class="form-control" id="main-search-inp" ng-model-options='{ debounce: 800 }' ng-model="vm.mainSearchInp" ng-change="vm.mainSearch()" placeholder="Search anything">
            </div>
        </div>
        <!-- <button class="btn btn-danger pull-right" ng-show="vm.progress" ng-click="vm.showModalToHandleConflict()">{{ vm.progress.message }}</button> -->
        <button ng-show="vm.conflict" class="btn btn-danger pull-right" ng-click="vm.showModalToHandleConflict()">Resolve Conflict</button>
    </div>
    <div id="main-log-context-menu" style="display: none;"></div>
    <div id="main-log-container" class="commit-container container-fluid" ng-class="{'details-visible': vm.commitDetails}" data-page-num="1">
        <div class="row">
            <div class="col-12">
                <span class="label-heading">Repository log</span> <span class="label-caption"> - Select a commit to view details or right click on a commit for more.</span>
            </div>
        </div>
        <div class="row" ng-if="vm.commits.length > 0">
            <div id="graph-container" class="col">
                <canvas id="log-graph" width="1" height="1"></canvas>
            </div>
            <div class="col" id="log-rows-container">
                <a-commit ng-repeat="hash in vm.hashes | filter:vm.filterOutTempCommits" hash="hash" select-commit="vm.selectCommit(commit)" selected-commit="vm.selectedCommit" on-finish-render="logNgRepeatFinished"></a-commit>
                <div id="main-log-loading-indicator">Loading next batch of commits...</div>
            </div>
        </div>
        <div class="no-commits-msg" ng-if="vm.commits.length == 0">
            There's no commits here
        </div>
    </div>
    <div class="details-container" ng-show="vm.commitDetails">
        <ul class="nav nav-tabs details-tabs" role="tablist">
            <li class="nav-item">
                <span class="nav-link active" data-target="#tab-commit" data-toggle="tab" role="tab">Commit</span>
            </li>
            <li class="nav-item">
                <span class="nav-link" data-target="#tab-file-tree" data-toggle="tab" role="tab">File tree</span>
            </li>
            <li class="nav-item">
                <span class="nav-link" data-target="#tab-diff" data-toggle="tab" role="tab">Diff</span>
            </li>
        </ul>
            
            <!-- Tab panes -->
        <div class="tab-content tab-content-details">
            <div class="tab-pane active" id="tab-commit" role="tabpanel">
                <div ng-if="vm.commitDetails" class="container-fluid">
                    <div ng-if="vm.commitDetails == 'loading'" class="row">
                        <div class="col-sm-12">Fetching commit details. Please wait...</div>
                    </div>
                    <div class="row" ng-if="vm.commitDetails != 'loading'">
                        <div class="col-sm-12">
                            <div>Author: {{vm.commitDetails.author}}</div>
                            <div>Date: ({{vm.commitDetails.date | date : 'medium'}})</div>
                            <div>Commit hash: {{vm.commitDetails.hash}}</div>
                            <div>Parent(s): <span class="btn-link parent-hash" ng-click="vm.selectCommit(parentHash)" ng-repeat="parentHash in vm.commitDetails.parentHashes track by $index">{{parentHash}} </span></div>
                            <div>Children: <span class="btn-link child-hash" ng-click="vm.selectCommit(childHash)" ng-repeat="childHash in vm.commitDetails.children track by $index">{{childHash}} </span></div>
                            <div class="commit-message">{{vm.commitDetails.message}}</div>
                            <div>Contained in branches: <span ng-repeat="branch in vm.commitDetails.branches"><span class="commit-in-branch commit-in-branch-{{branch.type}}">{{branch.name}}</span>{{$last ? '' : ', '}}</span></div>
                            <div ng-if="vm.commitDetails.tags.length">Contained in tags: <span ng-repeat="tag in vm.commitDetails.tags"><span class="commit-in-tag">{{tag}}</span>{{$last ? '' : ', '}}</span></div>
                            <div ng-if="vm.commitDetails.tags.length == 0">This commit is not contained in any tags.</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-pane" id="tab-file-tree" role="tabpanel">file tree</div>
            <div class="tab-pane" id="tab-diff" role="tabpanel">
                <div class="container-fluid height100" ng-if="vm.commitDetails">
                    <div class="row height100">
                        <div class="col-sm-4 height100 diff-files-list">
                            <files-list files="vm.commitDetails.diffDetails" on-select="vm.selectFileInLog(file)" selected-file="vm.selectedFileDiffRaw"></files-list>
                        </div>
                        <div class="col-sm-8 file-diff-column height100">
                            <div ng-bind-html="vm.selectedFileDiff" class="diff"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <commit-modal modal="vm.modals.commit" 
        refresh-local-changes="vm.refreshLocalChanges()"
        current-local-branch="vm.currentLocalBranch"
        local-status="vm.localStatus"
        parse-diff="vm.parseDiff(diff)"
        staged-files="vm.stagedFiles"
        unstaged-files="vm.unstagedFiles"
        refresh-log="vm.refreshLog()"
        show-push-dialog="vm.showPushDialog()">
    </commit-modal>
    <push-modal
        modal="vm.modals.push"
        current-local-branch="vm.currentLocalBranch"
        remote="vm.remote"
        remote-branches="vm.remoteBranches"
        refresh-log="vm.refreshLog()"
        on-push="vm.onPush()">
    </push-modal>
    <div class="modal fade" id="pull-modal" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
          <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Pull</h5>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              </div>
              <div class="modal-body">
                <div class="container-fluid">
                  <div class="row">
                    <div class="col-sm-12">
                      <div class="panel">
                        <h6>Branch</h6>
                        <div class="form-group row">
                          <label for="pull-dialog-local-branch" class="col-2 col-form-label">
                            Local branch
                          </label>
                          <div class="col-10">
                            <input id="pull-dialog-local-branch" type="text" class="form-control" value="{{vm.currentLocalBranch}}" disabled="disabled" />
                          </div>
                        </div>
                        <div class="form-group row">
                          <label for="pull-dialog-branch-select" class="col-2 col-form-label">
                            Remote branch
                          </label>
                          <div class="col-10">
                            <select class="form-control" id="pull-dialog-branch-select" ng-model="vm.pullOptions.remoteBranch">
                              <option ng-repeat="branch in vm.remoteBranches" value="{{branch}}">{{branch}}</option>
                            </select>
                          </div>
                        </div>
                      </div>
                      <div class="panel">
                        <h6>Merge Options</h6>
                        <div class="form-group row">
                          <div class="col-12">
                            <div class="form-check merge-option">
                              <label class="form-check-label">
                                <input class="form-check-input" type="radio" name="merge-options" id="merge-options-merge" value="merge" checked ng-model="vm.pullOptions.mergeOption">
                                Merge remote branch into current branch
                              </label>
                            </div>
                            <div class="form-check merge-option">
                              <label class="form-check-label">
                                <input class="form-check-input" type="radio" name="merge-options" id="merge-options-merge" value="rebase" ng-model="vm.pullOptions.mergeOption">
                                Rebase current branch on top of remote branch
                              </label>
                            </div>
                            <div class="form-check merge-option">
                              <label class="form-check-label">
                                <input class="form-check-input" type="radio" name="merge-options" id="merge-options-fetch" value="fetch" ng-model="vm.pullOptions.mergeOption">
                                Do not merge, only fetch remote changes
                              </label>
                            </div>
                          </div>
                        </div>
                      </div>
                      <button class="btn btn-primary pull-right" ng-click="vm.pull()" ng-disabled="((!vm.pullOptions.mergeOption || !vm.pullOptions.remoteBranch) && (vm.pullOptions.mergeOption != 'fetch'))">Pull</button>
                    </div>
                  </div>
                </div>
              </div>
          </div>
      </div>
    </div>
    
    <stash-modal
        modal="vm.modals.stash"
        parse-diff="vm.parseDiff(diff)"
        refresh-local-changes="vm.refreshLocalChanges()"
        local-status="vm.localStatus"
    ></stash-modal>
    <div class="modal fade" id="new-branch-modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-md" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create a new Branch</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-12">
                                <div class="form-inline">
                                    <div class="form-group row row-vertical-margin">
                                        <div class="col-12">
                                            Create branch at this revision
                                            <input type="text" value="{{vm.newBranch.atRevision}}" disabled="disabled" class="form-control" />
                                        </div>
                                    </div>
                                    <div class="form-group row row-vertical-margin">
                                        <div class="col-12">
                                            Branch Name
                                            <input type="text" class="form-control" ng-model="vm.newBranch.name" />
                                        </div>
                                    </div>
                                    <div class="form-group row row-vertical-margin">
                                        <div class="col-12">
                                            <label><input type="checkbox" ng-model="vm.newBranch.checkout"> Checkout after create</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row row-vertical-margin">
                            <div class="col-12">
                                <button class="btn btn-primary pull-right" ng-click="vm.createNewBranch()">Create Branch</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <conflict-modal
        modal="vm.modals.conflict"
        progress="vm.progress"
        parse-diff="vm.parseDiff(diff)"
        local-status="vm.localStatus"
        refresh-local-changes="vm.refreshLocalChanges()"
        refresh-log="vm.refreshLog()"
        parse-local-status="vm.parseLocalStatus(data)"
    ></conflict-modal>
    <cherrypick-modal
        modal="vm.modals.cherrypick"
        refresh-log="vm.refreshLog()"
        cherrypick-hash="vm.cherrypickHash"
        refresh-local-changes="vm.refreshLocalChanges()"
    ></cherrypick-modal>
</div>